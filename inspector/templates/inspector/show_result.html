{% extends 'inspector/base.html' %}

{% block content %}
<div class="content mt-4 p-4">
  <div class="row justify-content-md-center mb-4">
    <figure class="figure col-md-8">
      <div id="polar"></div>
    </figure>
  </div>
  <div class="row justify-content-md-center mb-4">
    <div class="col-md-8">
      <table class="table">
        <caption class="text-center">
          {% load tz %}
          {{ language}} model probed on {{ date|localtime|date:"j. M Y g:i A e" }}.
        </caption>
        <thead>
          <tr>
            <th scope="col">Probing Task</th>
            <th class="text-right" scope="col">Accuracy</th>
            <th class="text-right" scope="col">Loss</th>
          </tr>
        </thead>
        <tbody>
          {% load percentage %}
          {% for probing_task, metric in metrics.items %}
          <tr>
            <th scope="row">{{ probing_task }}</th>
            <td class="text-right">{{ metric.accuracy|percentage }} %</td>
            <td class="text-right">{{ metric.loss|floatformat:1 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="row justify-content-md-center">
    <div class="jumbotron bg-light border shadow-sm col-md-8">
      <h2>Share Results</h2>
      <p class="lead">Share or save the link to your results.</p>
      <hr class="my-4">
      <div class="form-row mb-4">
        <div class="col-8">
          <input type="text" class="form-control" id="share" value="{{ request.build_absolute_uri }}" readonly>
        </div>
        <div class="col-4">
          <a class="btn btn-primary" href="#">Copy to Clipboard</a>
        </div>
      </div>
      <a class="btn btn-secondary" href="/language/">Try Another Model</a>
    </div>
  </div>
</div>
{% endblock %}

{% block javascript %}
{% if debug %}
<script src="https://code.highcharts.com/highcharts.src.js"></script>
<script src="https://code.highcharts.com/highcharts-more.src.js"></script>
{# 'Use static resources in production instead of CDN' #}
{% else %}
{% load static %}
<script src="{% static 'inspector/highcharts/highcharts.src.js' %}"></script>
<script src="{% static 'inspector/highcharts/highcharts-more.src.js' %}"></script>
{% endif %}
<script>
Highcharts.setOptions({
  chart: {
    style: {
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"'
    }
  }
})
Highcharts.chart('polar', {
  chart: {
    polar: true,
    type: 'area'
  },
  colors: ['#b90f22', '#d7ac00', '#00689d', '#7fab16'],
  exporting: {
    buttons: {
      contextButton: {
        enabled: false
      }
    }
  },
  credits: {
    style: {
      color: '#6c757d'
    }
  },
  title: {
    text: null
  },
  xAxis: {
    categories: [
    {% for probing_task, _ in metrics.items %}
    '{{ probing_task }}'{% if not forloop.last %}, {% endif %}
    {% endfor %}
    ],
    lineColor: '#6c757d',
    labels: {
      style: {
        color: '#212529'
      }
    },
    tickmarkPlacement: 'on'
  },
  yAxis: {
    min: 0,
    max: 100,
    gridLineColor: '#dee2e6',
    minorGridLineColor: '#dee2e6',
    tickAmount: 5
  },
  legend: {
    enabled: false
  },
  series: [{
    name: 'Accuracy',
    data: [
    {% for _, metric in metrics.items %}
    {{ metric.accuracy|percentage }}{% if not forloop.last %}, {% endif %}
    {% endfor %}
    ],
    pointPlacement: 'on'
  }],
  tooltip: {
    backgroundColor: '#f8f9fa',
    style: {
      color: '#212529'
    },
    valueDecimals: 1,
    valueSuffix: ' %'
  }
});
var share = document.getElementById('share');
var button = document.getElementsByClassName('btn-primary')[0];
if (navigator.share) {
  button.innerHTML = 'Share';
}
button.onclick = function(e) {
  e.preventDefault();
  if (navigator.share) {
    // If available use native share sheet
    navigator.share({
      title: document.title,
      url: share.value
    })
  } else {
    // Copy to clipboard
    share.select();
    document.execCommand('copy');
  }
  // Iterate through colors with every click
  if (button.classList.contains('btn-primary')) {
    button.classList.replace('btn-primary', 'btn-warning');
  } else if (button.classList.contains('btn-warning')) {
    button.classList.replace('btn-warning', 'btn-info');
  } else if (button.classList.contains('btn-info')) {
    button.classList.replace('btn-info', 'btn-success');
  } else if (button.classList.contains('btn-success')) {
    button.classList.replace('btn-success', 'btn-primary');
  }
}
</script>
{% endblock %}
