{% extends 'inspector/base.html' %}

{% block content %}
<div class="content px-5">
  <div class="row justify-content-md-center mb-4">
    <div class="col-md-8">
      <div id="polar"></div>
    </div>
  </div>
  <div class="row justify-content-md-center mb-4">
    <div class="col-md-8">
      <table class="table table-hover">
        <thead>
          <tr>
            <th scope="col">Probing Task</th>
            <th scope="col">Accuracy</th>
            <th scope="col">Loss</th>
          </tr>
        </thead>
        <tbody>
          {% for probing_task, metric in metrics.items %}
          <tr>
            <th scope="row">{{ probing_task }}</th>
            <td>{{ metric.accuracy|floatformat:3 }}</td>
            <td>{{ metric.loss|floatformat:3 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="row justify-content-md-center">
    <div class="jumbotron col-md-8">
      <h2>Share Results</h2>
      <p class="lead">Share or save the link to your results.</p>
      <hr class="my-4">
      <div class="form-row mb-4">
        <div class="col-8">
          <input type="text" class="form-control" id="share" value="{{ request.build_absolute_uri }}" readonly>
        </div>
        <div class="col-4">
          <a class="btn btn-primary" href="#">Copy to Clipboard</a>
        </div>
      </div>
      <a class="btn btn-secondary" href="/language/">Try Another Model</a>
    </div>
  </div>
</div>
{% endblock %}

{% block javascript %}
<script src="https://code.highcharts.com/highcharts.src.js"></script>
<script src="https://code.highcharts.com/highcharts-more.src.js"></script>
{% comment 'Use static resources in production instead of CDN' %}
{% load static %}
<script src="{% static 'inspector/highcharts/highcharts.src.js' %}"></script>
<script src="{% static 'inspector/highcharts/highcharts-more.src.js' %}"></script>
{% endcomment %}
<script>
Highcharts.setOptions({
  chart: {
    style: {
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"'
    }
  }
})
Highcharts.chart('polar', {
  chart: {
    polar: true,
    type: 'area'
  },
  colors: ['#007bff', '#28a745', '#dc3545', '#ffc107', '#17a2b8'],
  exporting: {
    buttons: {
      contextButton: {
        enabled: false
      }
    }
  },
  credits: {
    style: {
      color: '#6c757d'
    }
  },
  title: {
    text: null
  },
  xAxis: {
    categories: [
    {% for probing_task, _ in metrics.items %}
    '{{ probing_task }}'{% if not forloop.last %}, {% endif %}
    {% endfor %}
    ],
    labels: {
      style: {
        color: '#212529'
      }
    },
    tickmarkPlacement: 'on'
  },
  yAxis: {
    min: 0,
    max: 1,
    tickAmount: 5
  },
  legend: {
    enabled: false
  },
  series: [{
    name: 'Accuracy',
    data: [
    {% for _, metric in metrics.items %}
    {{ metric.accuracy|floatformat:3 }}{% if not forloop.last %}, {% endif %}
    {% endfor %}
    ],
    pointPlacement: 'on'
  }],
  tooltip: {
    backgroundColor: '#f8f9fa',
    style: {
      color: '#212529'
    }
  }
});
var share = document.getElementById('share');
var button = document.getElementsByClassName('btn-primary')[0];
if (navigator.share) {
  button.innerHTML = 'Share';
}
button.onclick = function(e) {
  e.preventDefault();
  if (navigator.share) {
    // If available use native share sheet
    navigator.share({
      title: document.title,
      url: share.value
    })
  } else {
    // Copy to clipboard
    share.select();
    document.execCommand('copy');
  }
}
</script>
{% endblock %}
